<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</title>
    <!-- Tailwind CSS for styling and responsiveness -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- KaTeX for beautiful math symbols -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>

    <style>
        /* Import suitable fonts for Arabic and English text */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+Arabic:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans Arabic', 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 10vh;
            background-color: #eef2f6;
        }

        /* Set base styles for the body and the main container */
        .container {
            width: 100%;
            max-width: 900px;
            background-color: #fff;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 2rem auto;
            flex-grow: 1;
            /* Adjust padding for smaller screens */
            @media (max-width: 640px) {
                padding: 1rem;
            }
        }

        /* Main title and lesson idea sections */
        .section-header {
            font-size: 3rem; /* Adjusted for larger, more impactful title */
            font-weight: 700;
            color: #fff;
            text-align: center;
        }
        .lesson-idea-box {
            background-color: #e0f2fe;
            border-left: 6px solid #084c8f;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .explore-box {
            background-color: #fefce8; /* Light cool yellow */
            border-left: 6px solid #084c8f; /* Dark blue shadow on the left */
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); /* Matching box shadow */
        }
        .section-title {
            font-size: 1.8rem; /* Adjusted for better hierarchy */
            font-weight: 700;
            color: #084c8f;
            margin-bottom: 0.75rem;
        }
        .section-text {
            font-size: 1.25rem; /* Slightly larger for better readability */
            line-height: 1.7;
            color: #4a5568;
        }
        
        /* New rules to increase font size in the explore section */
        .explore-box .problem-list li p {
            font-size: 1.25rem;
        }
        .explore-box .problem-list li .math-expr {
            font-size: 1.6rem;
        }

        /* The main steps of the solution with a modern, split layout */
        .step-row {
            display: flex;
            align-items: stretch;
            gap: 2rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px dashed #e2e8f0;
            flex-wrap: wrap;
        }
        .step-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .algebra-col, .model-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 1rem;
            border-radius: 0.75rem;
        }
        .algebra-col {
            background-color: #f7fafc;
        }
        .model-col {
            background-color: #f0f4f8;
            border-left: 3px solid #cbd5e0;
        }

        /* Typography and layout for math expressions */
        .equation {
            font-size: 1.6rem; /* Increased font size for equations */
            font-weight: bold;
            color: #2d3748;
            text-align: left;
            line-height: 1.8;
            margin: 1rem 0;
            direction: ltr; /* Force left-to-right for math */
        }
        .explanation {
            font-size: 1.25rem; /* Increased font size for explanations */
            color: #718096;
            margin-bottom: 1rem;
            text-align: left;
        }
        
        /* New rule to increase font size for the division step */
        .font-larger .explanation {
            font-size: 1.35rem;
        }
        .font-larger .equation {
            font-size: 2.2rem;
        }

        /* Visual model styling */
        .model-inner {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        .model-row {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .x-box, .number-box, .result-box {
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 0.5rem;
            min-width: 3rem;
            height: 3rem;
            font-weight: 700;
            font-size: 1.2rem;
            color: #fff;
            box-shadow: inset 0 -3px 0 rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .x-box {
            background-color: #4c66e2;
            min-width: 5rem;
            height: 2rem;
        }
        .number-box { background-color: #f6ad55; }
        .result-box { background-color: #48bb78; }
        .subtraction-box {
            background-color: #e53e3e;
            color: #fff;
            position: relative;
            animation: fade-out 1s forwards;
        }
        
        @keyframes fade-out {
            to {
                opacity: 0;
                transform: scale(0.5);
            }
        }
        
        .divider {
            width: 100%;
            height: 2px;
            background-color: #cbd5e0;
            margin: 1rem 0;
            border-radius: 2px;
        }
        
        .equality-line {
            width: 80%;
            height: 4px;
            background-color: #084c8f;
            margin: 1rem 0;
            border-radius: 2px;
        }

        /* Check Understanding section and interactivity */
        .check-understanding-box {
            background-color: #fff8eb;
            border: 1px solid #fed7d7;
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .problem-list li {
            background-color: #fff;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .problem-list li:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
        }
        .solution-box {
            border-top: 2px dashed #fed7d7;
            padding-top: 1rem;
            margin-top: 1rem;
            background-color: #fffaf0;
        }
        
        .summary-box {
            background-color: #d1e7dd;
            border-left: 6px solid #198754;
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .summary-title {
            color: #198754;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        .summary-line {
            font-size: 1.4rem;
            font-weight: bold;
            color: #212529;
            direction: rtl;
            unicode-bidi: embed;
        }
        .math-expr-summary {
            font-size: 1.6rem; /* Adjusted for better visibility */
            font-weight: bold;
            color: #2d3748;
            direction: ltr;
            display: inline-block;
            margin-left: 0.5rem;
        }

        .full-solution-box {
            background-color: #f7f9fc;
            border: 2px solid #e2e8f0;
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .full-solution-box .section-title {
            color: #084c8f;
        }
        .full-solution-box .step {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
        }
        .full-solution-box .equation {
            font-size: 1.6rem; /* Adjusted for better visibility */
            color: #4a5568;
            font-weight: normal;
            direction: ltr; /* Force left-to-right for math */
        }
        .full-solution-box .equation .final-answer {
            font-size: 2rem; /* Made the final answer stand out */
            font-weight: bold;
            color: #1a56db;
        }
        
        /* New rule to increase font size for math expressions in "Check Understanding" section */
        .check-understanding-box .math-expr {
            font-size: 1.6rem; /* Adjusted for better visibility */
            direction: ltr; /* Force left-to-right for math */
        }

        /* Responsive design for smaller screens */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
            }
            .section-header {
                font-size: 2rem;
            }
            .step-row {
                flex-direction: column;
                align-items: center;
                gap: 1.5rem;
            }
            .algebra-col, .model-col {
                width: 100%;
                padding: 1.2rem;
                border-left: none;
            }
            .model-col {
                order: -1;
                border-bottom: 3px solid #cbd5e0;
                border-left: none;
            }
            .explanation {
                text-align: left;
            }
            .equation {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <!-- Main Content Container -->
    <main class="container">
        <!-- Professional Header -->
        <header class="bg-blue-800 text-white py-10 sm:py-12 text-center shadow-lg rounded-t-[1.5rem] relative overflow-hidden">
            <div class="absolute inset-x-0 bottom-0 h-1 bg-yellow-400"></div>
            <!-- Increased font size for the main title -->
            <h1 class="text-5xl sm:text-6xl font-bold">Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª</h1>
        </header>

        <!-- Example section based on the image -->
        <div class="bg-blue-100 text-blue-800 p-6 rounded-lg my-8 flex flex-col items-center shadow-md">
            <!-- Increased font size for the section title -->
            <h2 class="section-title text-center text-orange-500 text-2xl sm:text-3xl">
                Ù…Ø«Ø§Ù„: Ù…Ù† Ø§Ù„Ø­ÙŠØ§Ø©
            </h2>
            <div class="mt-2 text-center text-xl font-bold">
                <!-- Increased font size for the introductory text -->
                <p class="text-xl sm:text-2xl">Ù„Ø¯Ù‰ Ø¹Ù„ÙŠ 4 Ø¹Ù„Ø¨ Ù…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„Ø£Ù‚Ù„Ø§Ù…ØŒ ÙˆÙ‚Ù„Ù…Ø§Ù† Ø¥Ø¶Ø§ÙÙŠØ§Ù†ØŒ ÙˆÙ„Ø¯Ù‰ Ø®Ø§Ù„Ø¯ Ø¹Ù„Ø¨ØªØ§Ù† Ù…Ù„ÙŠØ¦ØªØ§Ù† Ø¨Ø§Ù„Ø£Ù‚Ù„Ø§Ù… Ùˆ 10 Ø£Ù‚Ù„Ø§Ù… Ø¥Ø¶Ø§ÙÙŠØ©. ÙƒÙ… Ù‚Ù„Ù…Ø§ ÙÙŠ Ø§Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯Ù‰ ÙƒÙ„ Ù…Ù†Ù‡Ù…Ø§ Ø§Ù„Ø¹Ø¯Ø¯ Ù†ÙØ³Ù‡ Ù…Ù† Ø§Ù„Ø£Ù‚Ù„Ø§Ù…ØŸ</p>
            </div>
            
            <!-- Updated and re-organized sentences -->
            <div class="mt-2 text-lg md:text-xl text-center text-black">
                <p class="font-bold">Ù„ÙŠÙƒÙ† Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ù„Ø§Ù… ÙÙŠ ÙƒÙ„ Ø¹Ù„Ø¨Ø© Ù‡Ùˆ $x$.</p>
                <p class="mt-4">
                    <span class="font-bold">ğŸ™‹â€â™‚ï¸ Ø¹Ù„ÙŠ:</span>
                    <span class="math-expr">$4x + 2$</span>
                </p>
                <p class="mt-2">
                    <span class="font-bold">ğŸ™‹ Ø®Ø§Ù„Ø¯:</span>
                    <span class="math-expr">$2x + 10$</span>
                </p>
                <p class="mt-4">Ø¨Ù…Ø§ Ø£Ù† Ù„Ø¯Ù‰ ÙƒÙ„ Ù…Ù†Ù‡Ù…Ø§ Ø§Ù„Ø¹Ø¯Ø¯ Ù†ÙØ³Ù‡ Ù…Ù† Ø§Ù„Ø£Ù‚Ù„Ø§Ù…ØŒ ÙØ¥Ù†:</p>
                <p class="mt-2 text-2xl md:text-3xl font-bold">
                    <span class="math-expr">$4x + 2 = 2x + 10$</span>
                </p>
            </div>
            <p class="mt-2 text-xl md:text-3xl font-bold text-center">
                Ø£Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ù„Ø£Ø¬Ø¯ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø°ÙŠ ÙŠÙ…Ø«Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ù„Ø§Ù… ÙÙŠ ÙƒÙ„ Ø¹Ù„Ø¨Ø©.
            </p>
        </div>

        <!-- Explanation section with interactive steps -->
        <div class="my-8">
            <h2 class="section-title text-center text-orange-500 text-2xl sm:text-3xl">Ø´Ø±Ø­ Ø§Ù„Ø­Ù„</h2>
            <p class="text-center mt-2 text-lg sm:text-xl">ØªØªØ¨Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„ÙÙ‡Ù… ÙƒÙŠÙÙŠØ© Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©.</p>
            <div class="step-row">
                <div class="model-col">
                    <div id="explanation-step" class="explanation text-center font-bold text-gray-700"></div>
                    <!-- Interactive model container -->
                    <div id="model-container" class="model-inner mt-4"></div>
                    <div class="flex justify-center gap-4 mt-4">
                        <button onclick="prevStep()" class="bg-gray-400 text-white font-bold py-2 px-4 rounded-full shadow-lg hover:bg-gray-500 transition duration-300 transform hover:scale-105">
                           Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                        </button>
                        <button onclick="nextStep()" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-full shadow-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105">
                            Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©
                        </button>
                    </div>
                </div>
                <div class="algebra-col">
                    <div class="explanation">Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©:</div>
                    <div id="algebra-step" class="equation"></div>
                </div>
            </div>
        </div>
        
        <!-- Full Written Solution Section -->
        <div class="full-solution-box">
            <h2 class="section-title">Ø§Ù„Ø­Ù„ Ø§Ù„Ù…ÙƒØªÙˆØ¨ Ø§Ù„ÙƒØ§Ù…Ù„</h2>
            <p class="step text-lg">
                <span class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© 1:</span> Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù‡ÙŠ <span class="math-expr-summary">$4x + 2 = 2x + 10$</span>.
            </p>
            <p class="step text-lg">
                <span class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© 2:</span> Ù†Ø·Ø±Ø­ <span class="math-expr-summary">$2x$</span> Ù…Ù† ÙƒÙ„Ø§ Ø§Ù„Ø·Ø±ÙÙŠÙ† Ù„Ø¹Ø²Ù„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª.
                <br> <span class="math-expr-summary">$4x - 2x + 2 = 2x - 2x + 10$</span>
                <br> <span class="math-expr-summary">$2x + 2 = 10$</span>
            </p>
            <p class="step text-lg">
                <span class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© 3:</span> Ù†Ø·Ø±Ø­ <span class="math-expr-summary">2</span> Ù…Ù† ÙƒÙ„Ø§ Ø§Ù„Ø·Ø±ÙÙŠÙ† Ù„Ø¹Ø²Ù„ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ <span class="math-expr-summary">$x$</span>.
                <br> <span class="math-expr-summary">$2x + 2 - 2 = 10 - 2$</span>
                <br> <span class="math-expr-summary">$2x = 8$</span>
            </p>
            <p class="step text-lg">
                <span class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© 4:</span> Ù†Ù‚Ø³Ù… ÙƒÙ„Ø§ Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ <span class="math-expr-summary">2</span> Ù„Ø¥ÙŠØ¬Ø§Ø¯ Ù‚ÙŠÙ…Ø© <span class="math-expr-summary">$x$</span>.
                <br> <span class="math-expr-summary">$\frac{2x}{2} = \frac{8}{2}$</span>
                <br> <span class="math-expr-summary">$x = 4$</span>
            </p>
            <p class="step text-lg">
                <span class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© 5:</span> Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù„ØŒ Ù†Ø¹ÙˆØ¶ Ù‚ÙŠÙ…Ø© <span class="math-expr-summary">$x$</span> ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©.
                <br> <span class="math-expr-summary">$4(4) + 2 = 2(4) + 10$</span>
                <br> <span class="math-expr-summary">$16 + 2 = 8 + 10$</span>
                <br> <span class="math-expr-summary">$18 = 18$</span>
                <br> <span class="text-green-600 font-bold">Ø§Ù„Ø­Ù„ ØµØ­ÙŠØ­.</span>
            </p>
        </div>

        <!-- Check Understanding Section -->
        <div class="check-understanding-box">
            <h2 class="section-title">Ø£ØªØ­Ù‚Ù‚ Ù…Ù† ÙÙ‡Ù…ÙŠ</h2>
            <p class="section-text text-lg mb-4">Ù†Ø§ØªØ¬ Ø¶Ø±Ø¨ Ø¹Ø¯Ø¯ Ù…Ø§ ÙÙŠ 3 Ø«Ù… Ø¥Ø¶Ø§ÙØ© 5 ÙŠØ³Ø§ÙˆÙŠ Ù†Ø§ØªØ¬ Ø¬Ù…Ø¹Ù‡ Ù…Ø¹ Ø§Ù„Ø¹Ø¯Ø¯ 23. ÙÙ…Ø§ Ø§Ù„Ø¹Ø¯Ø¯ØŸ</p>
            <div class="flex flex-col gap-4">
                <div class="flex items-center gap-4">
                    <label for="answerInput" class="text-lg font-bold">Ø§Ù„Ø¬ÙˆØ§Ø¨ Ù‡Ùˆ:</label>
                    <input type="number" id="answerInput" placeholder="Ø£Ø¯Ø®Ù„ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§" class="p-2 border rounded-md shadow-sm w-32 text-center">
                    <button onclick="checkAnswer()" class="bg-green-600 text-white font-bold py-2 px-6 rounded-md shadow-lg hover:bg-green-700 transition duration-300 transform hover:scale-105">
                        ØªØ­Ù‚Ù‚
                    </button>
                </div>
                <div id="feedbackMessage" class="text-center font-bold text-lg"></div>
            </div>
            
            <ul class="problem-list">
                <li onclick="toggleSolution(this)" class="mt-4">
                    <p class="section-text text-lg">
                       <span class="font-bold">Ø§Ø¸Ù‡Ø± Ø§Ù„Ø­Ù„ Ø§Ù„ÙƒØ§Ù…Ù„ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©</span>
                    </p>
                    <div class="solution-box" style="display:none;">
                        <div class="explanation">Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©:</div>
                        <div class="equation">$3x + 5 = x + 23$</div>
                        <div class="explanation">Ø§Ø·Ø±Ø­ $x$ Ù…Ù† ÙƒÙ„Ø§ Ø§Ù„Ø·Ø±ÙÙŠÙ†</div>
                        <div class="equation">$3x - x + 5 = x - x + 23$</div>
                        <div class="equation">$2x + 5 = 23$</div>
                        <div class="explanation">Ø§Ø·Ø±Ø­ 5 Ù…Ù† ÙƒÙ„Ø§ Ø§Ù„Ø·Ø±ÙÙŠÙ†</div>
                        <div class="equation">$2x = 18$</div>
                        <div class="explanation">Ø§Ù‚Ø³Ù… Ø¹Ù„Ù‰ 2</div>
                        <div class="equation">$x = 9$</div>
                    </div>
                </li>
            </ul>
        </div>
        
        <!-- Add Navigation Buttons -->
        <div class="flex justify-center mt-8 gap-4">
            <a href="u3l1p1.html" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-gray-700 transition duration-300 transform hover:scale-105 text-lg">
                Ø§Ù„Ø³Ø§Ø¨Ù‚
            </a>
            <a href="u3l1p4.html" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105 text-lg">
                Ø§Ù„ØªØ§Ù„ÙŠ
            </a>
        </div>
        
        <!-- Divider to separate the button and the footer -->
        <div class="w-full h-1 bg-gray-200 my-8"></div>

        <!-- Professional Footer -->
        <footer class="bg-blue-800 text-white p-4 text-center">
            <p class="text-sm">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2025</p>
        </footer>
    </main>
    
    <!-- JavaScript for interactivity and rendering math -->
    <script>
        // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© KaTeX Ø£ÙˆÙ„Ø§Ù‹
        function ensureKaTeXLoaded(callback) {
            if (typeof renderMathInElement !== 'undefined') {
                callback();
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù…Ø­Ù…Ù„Ø© Ø¨Ø¹Ø¯ØŒ Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                setTimeout(() => ensureKaTeXLoaded(callback), 100);
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            ensureKaTeXLoaded(function() {
                // Initial render of all static math expressions on the page
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$', right: '$', display: false},
                        {left: '$$', right: '$$', display: true}
                    ],
                    throwOnError: false
                });
                updateDisplay();
            });
        });

        let currentStep = 1;
        const totalSteps = 5;

        const modelContainer = document.getElementById('model-container');
        const algebraStep = document.getElementById('algebra-step');
        const explanationStep = document.getElementById('explanation-step');

        const stepsData = [
            // Step 1: Initial Equation
            {
                algebra: '$4x + 2 = 2x + 10$',
                explanation: 'Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©',
                model: `
                    <div class="model-row">
                        <div class="x-box">x</div><div class="x-box">x</div><div class="x-box">x</div><div class="x-box">x</div>
                        <div class="number-box">2</div>
                    </div>
                    <div class="equality-line"></div>
                    <div class="model-row">
                        <div class="x-box">x</div><div class="x-box">x</div>
                        <div class="number-box">10</div>
                    </div>
                `
            },
            // Step 2: Subtract 2x from both sides
            {
                algebra: '$2x + 2 = 10$',
                explanation: 'Ù†Ø·Ø±Ø­ $2x$ Ù…Ù† ÙƒÙ„Ø§ Ø§Ù„Ø·Ø±ÙÙŠÙ†',
                model: `
                    <div class="model-row">
                        <div class="x-box">x</div><div class="x-box">x</div>
                        <div class="number-box">2</div>
                    </div>
                    <div class="equality-line"></div>
                    <div class="model-row">
                        <div class="number-box">10</div>
                    </div>
                `
            },
            // Step 3: Subtract 2 from both sides
            {
                algebra: '$2x = 8$',
                explanation: 'Ù†Ø·Ø±Ø­ 2 Ù…Ù† ÙƒÙ„Ø§ Ø§Ù„Ø·Ø±ÙÙŠÙ†',
                model: `
                    <div class="model-row">
                        <div class="x-box">x</div><div class="x-box">x</div>
                    </div>
                    <div class="equality-line"></div>
                    <div class="model-row">
                        <div class="number-box">8</div>
                    </div>
                `
            },
            // Step 4: Divide both sides by 2 to find x
            {
                algebra: '$x = 4$',
                explanation: 'Ù†Ù‚Ø³Ù… Ø¹Ù„Ù‰ 2 Ù„Ø¥ÙŠØ¬Ø§Ø¯ Ù‚ÙŠÙ…Ø© $x$',
                model: `
                    <div class="model-row">
                        <div class="x-box">x</div>
                    </div>
                    <div class="equality-line"></div>
                    <div class="model-row">
                        <div class="number-box">4</div>
                    </div>
                `
            },
            // Step 5: Check Solution
            {
                algebra: '$18 = 18$',
                explanation: 'Ù†ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù„',
                model: `
                    <div class="model-row">
                        <div class="number-box">18</div>
                    </div>
                    <div class="equality-line"></div>
                    <div class="model-row">
                        <div class="number-box">18</div>
                    </div>
                `
            }
        ];

        function updateDisplay() {
            const stepIndex = currentStep - 1;
            explanationStep.textContent = stepsData[stepIndex].explanation;
            modelContainer.innerHTML = stepsData[stepIndex].model;
            algebraStep.innerHTML = stepsData[stepIndex].algebra;
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… setTimeout Ù„Ø¶Ù…Ø§Ù† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« DOM
            setTimeout(() => {
                ensureKaTeXLoaded(function() {
                    // Re-render math after updating content
                    renderMathInElement(modelContainer, {
                        delimiters: [
                            {left: '$', right: '$', display: false},
                            {left: '$$', right: '$$', display: true}
                        ],
                        throwOnError: false
                    });
                    renderMathInElement(algebraStep, {
                        delimiters: [
                            {left: '$', right: '$', display: false},
                            {left: '$$', right: '$$', display: true}
                        ],
                        throwOnError: false
                    });
                });
            }, 0);
        }

        window.nextStep = function() {
            if (currentStep < totalSteps) {
                currentStep++;
                updateDisplay();
            }
        };

        window.prevStep = function() {
            if (currentStep > 1) {
                currentStep--;
                updateDisplay();
            }
        };

        window.toggleSolution = function(element) {
            const solutionBox = element.querySelector('.solution-box');
            if (solutionBox) {
                solutionBox.style.display = solutionBox.style.display === 'none' ? 'block' : 'none';
                
                // Re-render math when the solution box is shown
                if (solutionBox.style.display === 'block') {
                    setTimeout(() => {
                        ensureKaTeXLoaded(function() {
                            renderMathInElement(solutionBox, {
                                delimiters: [
                                    {left: '$', right: '$', display: false},
                                    {left: '$$', right: '$$', display: true}
                                ],
                                throwOnError: false
                            });
                        });
                    }, 0);
                }
            }
        };

        window.checkAnswer = function() {
            const answerInput = document.getElementById('answerInput');
            const feedbackMessage = document.getElementById('feedbackMessage');
            const userAnswer = parseInt(answerInput.value);
            const correctAnswer = 9; // The correct answer for the problem

            if (isNaN(userAnswer)) {
                feedbackMessage.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù….';
                feedbackMessage.className = 'text-center font-bold text-lg text-yellow-600';
            } else if (userAnswer === correctAnswer) {
                feedbackMessage.textContent = 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! Ø£Ø­Ø³Ù†Øª!';
                feedbackMessage.className = 'text-center font-bold text-lg text-green-600';
            } else {
                feedbackMessage.textContent = 'Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                feedbackMessage.className = 'text-center font-bold text-lg text-red-600';
            }
        };
    </script>
</body>
</html>

