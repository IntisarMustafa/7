<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ضرب الأعداد النسبية وقسمتها - الصف السابع</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Arial:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        /* تعريف المتغيرات لألوان جذابة وباردة من القالب المطلوب */
        :root {
            --royal-blue: #0c2461;
            --gold: #f6b93b;
            --light-blue: #81c7ff;
            --sky-blue: #4a69bd;
            --pale-blue: #e0f7fa;
            --royal-blue-2: #4169e1; /* لون أزرق ملكي جديد */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background-color: var(--pale-blue);
            color: #333;
            line-height: 1.8;
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 1.1rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            
             header {
            background-color: var(--royal-blue-2);
            color: white;
            padding: 25px;
            text-align: center;
            border-bottom: 5px solid var(--gold);
            position: relative;
            overflow: hidden;
        }
        }

       

        h1 {
            color: white;
            font-size: 2.8rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .subtitle {
            color: var(--gold);
            font-size: 1.6rem;
            font-weight: 700;
        }

        .page {
            padding: 35px;
            border-bottom: 1px solid #e0f0ff;
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--sky-blue);
            margin: 25px 0;
        }

        .section h2 {
            color: var(--royal-blue-2);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px dashed var(--gold);
            display: flex;
            align-items: center;
            font-size: 1.8rem;
            gap: 10px;
        }

        .section h2::before {
            content: "•";
            color: var(--gold);
            font-size: 2.2rem;
            margin-left: 10px;
        }
        
        .lesson-idea, .basic-concept, .full-example, .example, .exercise {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--sky-blue);
            margin: 25px 0;
        }

        .lesson-idea {
            border-left: 5px solid var(--gold);
        }
        
        .lesson-idea h3 {
            color: var(--royal-blue-2);
            border-bottom: 3px solid var(--gold);
            padding-bottom: 15px;
            margin-bottom: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .basic-concept h3 {
            color: var(--royal-blue-2);
            border-bottom: 3px solid var(--gold);
            padding-bottom: 15px;
            margin-bottom: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }
        
        .formula-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: var(--pale-blue);
            border-radius: 10px;
            border: 1px dashed var(--royal-blue);
        }

        .math-formula {
            font-size: 24px;
            color: var(--royal-blue);
            font-weight: bold;
        }

        .symbols {
            font-family: 'Courier New', monospace;
            font-size: 20px;
            text-align: center;
            margin: 20px 0;
            color: var(--gold);
            font-weight: bold;
        }
        
        .full-example, .exercise {
            border: 3px solid var(--gold);
            background-color: #f9fbe7;
        }
        
        .full-example h3 {
            color: var(--royal-blue-2);
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--royal-blue);
        }
        
        .example-section {
            margin: 20px 0;
            padding: 15px;
            background-color: var(--pale-blue);
            border-radius: 10px;
            border-left: 4px solid var(--royal-blue);
        }

        .example h3 {
            color: var(--royal-blue-2);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px dashed var(--gold);
            font-size: 1.8rem;
        }

        .math-expression {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: #fff8e1;
            border-radius: 10px;
            border: 3px solid var(--gold);
            overflow-x: auto;
            color: var(--royal-blue);
        }
        
        .inline-math {
            font-size: 1.3rem;
            font-weight: normal;
            color: var(--gold);
            display: inline-block;
            margin: 0 4px; 
        }
        
        .exercise h3, .exercise-title {
            color: var(--royal-blue-2);
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 3px solid var(--royal-blue);
            padding-bottom: 10px;
        }
        
        .exercise-title i {
            margin-left: 10px;
            color: var(--gold);
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .question-item {
            background: linear-gradient(to bottom, #f5f5f5, #e8e8e8);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        .question-text {
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: bold;
            color: var(--royal-blue);
        }
        
        .answer-input {
            padding: 10px;
            border: 2px solid var(--gold);
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
            max-width: 250px;
            margin: 10px 0;
            text-align: center;
        }
        
        .check-button {
            background: var(--gold);
            color: var(--royal-blue);
            border: none;
            padding: 14px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1.2rem;
            margin-top: 15px;
            font-weight: 700;
            display: block;
            margin: 15px auto;
            width: 100%;
            max-width: 250px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .check-button:hover {
            background: #ffd166;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }
        
        .result-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            display: none;
            text-align: center;
        }
        
        .correct {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #a5d6a7;
            display: block;
        }
        
        .incorrect {
            background-color: #ffebee;
            color: #c62828;
            border: 2px solid #ef9a9a;
            display: block;
        }
        
        .solution {
            margin-top: 10px;
            font-size: 1rem;
            color: #666;
            text-align: center;
        }
        
        .page-number {
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            color: var(--royal-blue);
            font-size: 1.1rem;
            padding: 10px;
            background-color: var(--pale-blue);
            border-radius: 5px;
        }
        
        .highlight {
            background: var(--gold);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            color: var(--royal-blue);
        }
        
        .method-box {
            background: var(--pale-blue);
            border: 1px solid var(--sky-blue);
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 100, 200, 0.08);
        }

        .method-title {
            color: var(--royal-blue);
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: center;
            padding: 25px;
            background: linear-gradient(to bottom, #f5f5f5, #e8e8e8);
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-button {
            background: var(--gold);
            color: var(--royal-blue);
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            text-decoration: none;
            display: inline-block;
            text-align: center;
            min-width: 150px;
        }

        .nav-button:hover {
            background: #ffd166;
            transform: translateY(-3px);
        }

        .nav-button:active {
            transform: translateY(1px);
        }

        .nav-button.next-button {
            background: var(--royal-blue-2);
            color: white;
            border: 2px solid var(--gold);
        }

        .nav-button.next-button:hover {
            background: #2a4c9e;
        }

        .unit-title {
            background: var(--royal-blue);
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            margin: 25px 0;
            font-size: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .header-explore {
            text-align: center;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.85);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(8px);
        }
        
        .header-explore h1 {
            color: var(--royal-blue);
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 800;
            background: linear-gradient(to right, var(--royal-blue), #0d3a4d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            overflow: hidden;
        }
        
        .interactive-scene {
            position: relative;
            width: 100%;
            height: 500px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            perspective: 1000px;
            margin-top: 20px;
            background: linear-gradient(to bottom, #87ceeb, #e0f7fa);
        }
        
        .scene-container {
            flex: 1;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            position: relative;
            width: 100%;
            height: 100%;
        }

        #schoolScene {
            width: 100%;
            height: 100%;
            display: block;
            touch-action: none;
        }
        
        .mobile-controls {
            position: absolute;
            bottom: 30px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 100;
            pointer-events: none;
        }

        .movement-controls, .camera-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: auto;
        }

        .control-row {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .control-btn {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 10px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            user-select: none;
            backdrop-filter: blur(5px);
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .control-btn:active {
            background: rgba(76, 175, 80, 0.5);
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .problem-box {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12), 0 5px 15px rgba(26, 95, 122, 0.15);
            border: 3px solid var(--royal-blue);
            text-align: center;
            backdrop-filter: blur(8px);
            animation: box-float 5s infinite alternate ease-in-out;
            position: relative;
            overflow: hidden;
            margin-top: 30px;
        }
        
        .problem-title {
            color: var(--royal-blue);
            font-size: 2rem;
            margin-bottom: 25px;
            font-weight: 800;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--pale-blue);
            font-family: 'Cairo', sans-serif;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        
        .problem-text {
            font-size: 1.2rem;
            line-height: 1.8;
            color: #333;
            font-family: 'Cairo', sans-serif;
            margin-bottom: 15px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .problem-text .math-expression {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--gold);
            margin: 0 8px;
            padding: 12px 18px;
            background: rgba(255, 248, 225, 0.85);
            border-radius: 12px;
            display: inline-block;
            border: 2px solid #ffcc80;
            box-shadow: 0 5px 10px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .solution-btn {
            margin-top: 25px;
            padding: 15px 40px;
            font-size: 1.2rem;
            background: var(--gold);
            color: var(--royal-blue);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            font-weight: bold;
        }
        
        .solution-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
            background: #ffd166;
        }
        
        .solution-content {
            margin-top: 25px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.92);
            border-radius: 15px;
            border-left: 5px solid var(--royal-blue);
            display: none;
            animation: fadeIn 0.6s ease forwards;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .solution-content h3 {
            color: var(--royal-blue);
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .solution-step {
            margin: 15px 0;
            padding: 15px;
            background: var(--pale-blue);
            border-radius: 10px;
            border-left: 3px solid var(--royal-blue);
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .highlight-solution {
            background: var(--gold);
            padding: 0 5px;
            border-radius: 4px;
            font-weight: bold;
            color: var(--royal-blue);
        }
        
        .footer-note {
            text-align: center;
            padding: 20px;
            background: var(--royal-blue);
            color: white;
            border-top: 3px solid var(--gold);
            font-size: 1rem;
        }

        .footer-note h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--gold);
        }

        @media (max-width: 768px) {
            body { font-size: 1rem; padding: 10px; }
            h1 { font-size: 2.2rem; }
            .subtitle { font-size: 1.3rem; }
            .section h2 { font-size: 1.5rem; }
            .lesson-idea h3, .basic-concept h3 { font-size: 1.3rem; }
            .math-expression { font-size: 1rem; }
            .nav-buttons { flex-direction: column; align-items: center; }
            .nav-button { width: 100%; max-width: 300px; }
            .problem-title { font-size: 1.5rem; }
            .problem-text { font-size: 1.1rem; }
            .problem-text .math-expression { font-size: 1.2rem; }
            .solution-btn { font-size: 1.1rem; padding: 12px 25px; }
            .interactive-scene { height: 400px; }
            .mobile-controls { padding: 0 10px; }
            .control-btn { width: 60px; height: 60px; font-size: 20px; }
        }
        .interactive-info {
            text-align: center;
            padding: 15px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        .interactive-info h3 {
            font-size: 1.6rem;
            color: var(--royal-blue);
            margin-bottom: 10px;
        }
        .interactive-info p {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.6;
        }
        
        #fullscreenBtn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.4);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: var(--royal-blue);
            z-index: 101;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        #fullscreenBtn:hover {
            background: rgba(255, 255, 255, 0.6);
            transform: scale(1.05);
        }
        
    </style>
</head>
<body>
    <div class="container">
        <div id="page1" class="page">
            <header>
                <h1>ضرب الأعداد النسبية وقسمتها</h1>
                <div class="subtitle">الرياضيات - الصف السابع</div>
            </header>
            
            <div class="lesson-idea">
                <h3><i class="fas fa-lightbulb"></i> فكرة الدرس</h3>
                <p>أضرب أعداداً نسبية وأقسمها.</p>
            </div>
            
            <div class="interactive-info">
                <h3>حديقة المدرسة التفاعلية</h3>
                <p>تجول في المشهد وحل المسألة الرياضية!</p>
                <p><strong>إرشادات:</strong> اسحب بإصبعك على شاشات اللمس وفي شاشة الكمبيوتراستخدم الماوس للنظر حولك، واستخدم مفاتيح الأسهم للحركة.</p>
            </div>

            <div class="interactive-scene" id="interactive-scene">
                <div class="scene-container">
                    <canvas id="schoolScene"></canvas>
                </div>
                
                <button id="fullscreenBtn" title="ملء الشاشة">
                    <i class="fas fa-expand"></i>
                </button>

                <div class="mobile-controls">
                    <div class="movement-controls">
                        <div class="control-row">
                            <div class="control-btn" id="forwardBtn">↑</div>
                        </div>
                        <div class="control-row">
                            <div class="control-btn" id="rightBtn">→</div>
                            <div class="control-btn" id="backwardBtn">↓</div>
                            <div class="control-btn" id="leftBtn">←</div>
                        </div>
                    </div>
                    <div class="camera-controls">
                    </div>
                </div>
            </div>
            
            <div class="problem-box">
                <div class="problem-title">أستكشف</div>
                <div class="problem-text">
                    زرع أحمد وزملاؤه عدداً من الأشجار في حديقة المدرسة، وبعد الانتهاء من زراعتها، أضافوا إلى كل شجرة 
                    <span class="inline-math">\( \frac{3}{4} \)</span> 
                    الكوب من السماد لتزويد التربة بالعناصر الضرورية. 
                    إذا كان لديهم 
                    <span class="inline-math">60 كوباً</span> 
                    من السماد، فكم شجرة يمكنهم أن يضيفوا إليها سماداً؟
                </div>
                
                <button class="solution-btn" onclick="toggleSolution()">اظهر الحل</button>
                
                <div class="solution-content" id="solution">
                    <h3>حل المسألة</h3>
                    
                    <div class="solution-step">
                        <p>لحساب عدد الأشجار، نقسم كمية السماد الكلية على كمية السماد اللازمة لكل شجرة:</p>
                    </div>
                    
                    <div class="solution-step">
                        <p>الصيغة الرياضية:</p>
                        <p class="problem-text math-expression">\( \text{عدد الأشجار} = \frac{\text{كمية السماد الكلية}}{\text{كمية السماد لكل شجرة}} \)</p>
                    </div>
                    
                    <div class="solution-step">
                        <p>بالتعويض بالقيم المعطاة:</p>
                        <p class="problem-text math-expression">\( \text{عدد الأشجار} = \frac{60}{\frac{3}{4}} \)</p>
                    </div>
                    
                    <div class="solution-step">
                        <p>قسمة كسرية تعادل الضرب في مقلوب الكسر:</p>
                        <p class="problem-text math-expression">\( = 60 \times \frac{4}{3} \)</p>
                    </div>
                    
                    <div class="solution-step">
                        <p>نقوم بالتبسيط:</p>
                        <p class="problem-text math-expression">\( = \frac{60 \times 4}{3} = \frac{240}{3} = 80 \)</p>
                    </div>
                    
                    <div class="solution-step">
                        <p>إذن يمكنهم تسميد <span class="highlight-solution">80 شجرة</span> بالكمية المتوفرة من السماد.</p>
                    </div>
                </div>
            </div>
            
            <div class="basic-concept">
                <h3><i class="fas fa-book"></i> مفهوم أساسي</h3>
                <p>بالكلمات: عند ضرب كسرين، أضرب البسط في البسط، ثم أضرب المقام في المقام.</p>
                
                <div class="formula-container">
                    <div class="math-formula">
                        \( \frac{a}{b} \times \frac{c}{d} = \frac{a \times c}{b \times d} \)
                    </div>
                    <div class="symbols">
                        حيث \( b \neq 0, \, d \neq 0 \)
                    </div>
                </div>
            </div>
            
            <div class="full-example">
                <h3>مثال 1</h3>
                <p>أجد ناتج الضرب في أبسط صورة:</p>
                
                <div class="example-section">
                    <div class="math-expression">
                        1) \( \frac{2}{7} \times \frac{1}{6} = \frac{2 \times 1}{7 \times 6} = \frac{2}{42} \)
                    </div>
                    <p>أقسم كل من العددين 2، 42 على العامل المشترك الأكبر (2)</p>
                    <div class="math-expression">
                        \( = \frac{1 \times 1}{7 \times 3} = \frac{1}{21} \)
                    </div>
                </div>
                
                <div class="example-section">
                    <div class="math-expression">
                        2) \( -\frac{3}{8} \times \frac{2}{9} = -\frac{3 \times 2}{8 \times 9} = -\frac{6}{72} \)
                    </div>
                    <p>أقسم العددين 6، 72 على العامل المشترك الأكبر (6)</p>
                    <div class="math-expression">
                        \( = -\frac{1 \times 1}{4 \times 3} = -\frac{1}{12} \)
                    </div>
                    <p>استخدم إشارات ضرب الأعداد الصحيحة لتحديد إشارة ناتج ضرب البسطين أو المقامين.</p>
                </div>
                
                <div class="example-section">
                    <div class="math-expression">
                        3) \( 2 \frac{1}{2} \times 4 \frac{2}{3} \)
                    </div>
                    <p>تحويل الأعداد الكسرية إلى كسور غير فعلية:</p>
                    <div class="math-expression">
                        \( 2 \frac{1}{2} \times 4 \frac{2}{3} = \frac{5}{2} \times \frac{14}{3} \)
                    </div>
                    <p>إيجاد ناتج الضرب:</p>
                    <div class="math-expression">
                        \( = \frac{5 \times 14}{2 \times 3} = \frac{70}{6} \)
                    </div>
                    <p>التبسيط وإعادة الكتابة على شكل عدد كسري:</p>
                    <div class="math-expression">
                        \( = \frac{35}{3} = 11 \frac{2}{3} \)
                    </div>
                </div>
            </div>
            
            <div class="page-number">الصفحة 1 </div>
        </div>
        
        <div class="nav-buttons">
            <a href="u1l5p2.html" class="nav-button next-button">
                التالي
            </a>
        </div>

        <div class="footer-note">
        </div>
    </div>
    
    <script>
        // تهيئة مشهد Three.js للحديقة المدرسية
        function initScene() {
            const sceneContainer = document.getElementById('interactive-scene');
            const canvas = document.getElementById('schoolScene');
            
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 20, 100);

            const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.setPixelRatio(window.devicePixelRatio);

            const camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            camera.position.set(0, 5, 10);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const sunLight = new THREE.DirectionalLight(0xFDB813, 1);
            sunLight.position.set(100, 200, 100);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 1024;
            sunLight.shadow.mapSize.height = 1024;
            sunLight.shadow.camera.near = 0.5;
            sunLight.shadow.camera.far = 300;
            scene.add(sunLight);

            const groundGeometry = new THREE.PlaneGeometry(200, 200, 100, 100);
            const groundMaterial = new THREE.MeshStandardMaterial({
                color: 0x228B22,
                roughness: 0.9,
                metalness: 0.1
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            function createSchool(x, z) {
                const schoolGroup = new THREE.Group();

                const mainBuildingGeometry = new THREE.BoxGeometry(40, 20, 15);
                const mainBuildingMaterial = new THREE.MeshStandardMaterial({ color: 0xB0E0E6, roughness: 0.8 });
                const mainBuilding = new THREE.Mesh(mainBuildingGeometry, mainBuildingMaterial);
                mainBuilding.position.y = 10;
                mainBuilding.castShadow = true;
                mainBuilding.receiveShadow = true;
                schoolGroup.add(mainBuilding);

                const roofGeometry = new THREE.ConeGeometry(25, 10, 4);
                const roofMaterial = new THREE.MeshStandardMaterial({ color: 0x8B0000 });
                const roof = new THREE.Mesh(roofGeometry, roofMaterial);
                roof.position.y = 20 + 5;
                roof.rotation.y = Math.PI / 4;
                roof.castShadow = true;
                roof.receiveShadow = true;
                schoolGroup.add(roof);

                const doorGeometry = new THREE.BoxGeometry(4, 8, 0.5);
                const doorMaterial = new THREE.MeshStandardMaterial({ color: 0x5C4033 });
                const door = new THREE.Mesh(doorGeometry, doorMaterial);
                door.position.set(0, 4, 7.5);
                door.castShadow = true;
                schoolGroup.add(door);

                const windowMaterial = new THREE.MeshStandardMaterial({ color: 0x4a69bd, transparent: true, opacity: 0.8 });

                for (let i = -15; i <= 15; i += 10) {
                    const windowGeometry = new THREE.BoxGeometry(5, 5, 0.5);
                    const windowLeft = new THREE.Mesh(windowGeometry, windowMaterial);
                    windowLeft.position.set(i, 13, 7.5);
                    windowLeft.castShadow = true;
                    schoolGroup.add(windowLeft);

                    const windowRight = new THREE.Mesh(windowGeometry, windowMaterial);
                    windowRight.position.set(i, 13, -7.5);
                    windowRight.castShadow = true;
                    schoolGroup.add(windowRight);
                }

                schoolGroup.position.set(x, 0, z);
                scene.add(schoolGroup);
            }

            function createTree(x, z) {
                const treeGroup = new THREE.Group();

                const trunkGeometry = new THREE.CylinderGeometry(0.5, 0.5, 3, 8);
                const trunkMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
                const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                trunk.position.y = 1.5;
                trunk.castShadow = true;
                trunk.receiveShadow = true;
                treeGroup.add(trunk);

                const leavesMaterial = new THREE.MeshStandardMaterial({
                    color: 0x2E8B57,
                    roughness: 0.7,
                    metalness: 0.2
                });

                const baseSize = 2;
                const leavesCount = 8;

                for (let i = 0; i < leavesCount; i++) {
                    const sphereGeometry = new THREE.SphereGeometry(
                        baseSize * (0.6 + Math.random() * 0.4),
                        16,
                        16
                    );

                    const leavesPart = new THREE.Mesh(sphereGeometry, leavesMaterial);

                    const offsetX = (Math.random() - 0.5) * baseSize * 1.5;
                    const offsetY = (Math.random() - 0.5) * baseSize * 0.8;
                    const offsetZ = (Math.random() - 0.5) * baseSize * 1.5;

                    leavesPart.position.set(offsetX, 3.5 + offsetY, offsetZ);
                    leavesPart.castShadow = true;
                    leavesPart.receiveShadow = true;
                    treeGroup.add(leavesPart);
                }

                treeGroup.position.set(x, 0, z);
                treeGroup.scale.set(0.7, 0.7, 0.7);
                scene.add(treeGroup);

                return treeGroup;
            }

            function createBucket(x, z) {
                const bucketGroup = new THREE.Group();

                const bucketGeometry = new THREE.CylinderGeometry(0.8, 0.6, 0.8, 16);
                const bucketMaterial = new THREE.MeshStandardMaterial({ color: 0xAAAAAA, roughness: 0.8 });
                const bucket = new THREE.Mesh(bucketGeometry, bucketMaterial);
                bucket.position.y = 0.4;
                bucket.castShadow = true;
                bucketGroup.add(bucket);

                const handleGeometry = new THREE.TorusGeometry(0.8, 0.05, 8, 30, Math.PI);
                const handleMaterial = new THREE.MeshStandardMaterial({ color: 0x666666 });
                const handle = new THREE.Mesh(handleGeometry, handleMaterial);
                handle.position.y = 0.8;
                handle.rotation.x = Math.PI / 2;
                handle.rotation.z = Math.PI;
                handle.castShadow = true;
                bucketGroup.add(handle);

                const textCanvas = document.createElement('canvas');
                const context = textCanvas.getContext('2d');

                textCanvas.width = 512;
                textCanvas.height = 256;
                context.fillStyle = 'white';
                context.fillRect(0, 0, textCanvas.width, textCanvas.height);
                context.font = 'bold 60px Cairo';
                context.fillStyle = '#333333';
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                context.fillText('3/4 الكوب سماد', textCanvas.width / 2, textCanvas.height / 2);

                const texture = new THREE.CanvasTexture(textCanvas);
                const textMaterial = new THREE.MeshBasicMaterial({ map: texture, transparent: true, side: THREE.DoubleSide });
                const textPlane = new THREE.Mesh(new THREE.PlaneGeometry(1, 0.5), textMaterial);
                textPlane.position.set(0, 0.6, 0.6);
                textPlane.rotation.y = Math.PI;
                bucketGroup.add(textPlane);

                bucketGroup.position.set(x, 0, z);
                bucketGroup.scale.set(0.7, 0.7, 0.7);
                scene.add(bucketGroup);
            }

            function createPerson(x, z, type, gender, bodyType = 'normal', clothingColor = 0x4169E1) {
                const personGroup = new THREE.Group();

                let bodyHeight, headSize, bodyWidth, armRadius, legRadius, armLength, legLength, hairColor, neckHeight;

                if (type === 'adult') {
                    bodyHeight = 2.0;
                    headSize = 0.6;
                    bodyWidth = 1.0;
                    armRadius = 0.2;
                    legRadius = 0.25;
                    armLength = 1.0;
                    legLength = 1.0;
                    neckHeight = 0.3;
                } else {
                    bodyHeight = 1.5;
                    headSize = 0.5;
                    bodyWidth = 0.8;
                    armRadius = 0.15;
                    legRadius = 0.2;
                    armLength = 0.8;
                    legLength = 0.8;
                    neckHeight = 0.2;
                }

                if (gender === 'male') {
                    bodyWidth *= 1.2;
                    hairColor = 0x5c3a21;
                } else {
                    bodyWidth *= 0.9;
                    hairColor = 0x5c3a21;
                }

                if (bodyType === 'heavy') {
                    bodyWidth *= 1.5;
                    armRadius *= 1.5;
                    legRadius *= 1.5;
                }

                const headColor = 0xF5DEB3;
                const torsoYPosition = bodyHeight / 2 + legLength;
                const neckYPosition = torsoYPosition + bodyHeight / 2 + neckHeight / 2;
                const headYPosition = neckYPosition + neckHeight / 2 + headSize;
                const armXPosition = bodyWidth * 0.6 + armRadius;
                const handYPosition = torsoYPosition + bodyHeight * 0.4 - armLength * 0.5;
                const legXPosition = bodyWidth * 0.3;

                const torsoGeometry = new THREE.BoxGeometry(bodyWidth, bodyHeight, bodyWidth * 0.7);
                const torsoMaterial = new THREE.MeshStandardMaterial({ color: clothingColor, roughness: 0.8 });
                const torso = new THREE.Mesh(torsoGeometry, torsoMaterial);
                torso.position.y = torsoYPosition;
                torso.castShadow = true;
                personGroup.add(torso);

                const neckGeometry = new THREE.CylinderGeometry(headSize * 0.4, headSize * 0.4, neckHeight, 8);
                const neckMaterial = new THREE.MeshStandardMaterial({ color: headColor, roughness: 0.8 });
                const neck = new THREE.Mesh(neckGeometry, neckMaterial);
                neck.position.y = neckYPosition;
                neck.castShadow = true;
                personGroup.add(neck);

                const armMaterial = new THREE.MeshStandardMaterial({ color: clothingColor, roughness: 0.8 });
                const leftArm = new THREE.Mesh(new THREE.CylinderGeometry(armRadius, armRadius, armLength, 8), armMaterial);
                leftArm.position.set(-armXPosition, handYPosition, 0);
                leftArm.rotation.z = -Math.PI / 4;
                leftArm.castShadow = true;
                personGroup.add(leftArm);

                const rightArm = new THREE.Mesh(new THREE.CylinderGeometry(armRadius, armRadius, armLength, 8), armMaterial);
                rightArm.position.set(armXPosition, handYPosition, 0);
                rightArm.rotation.z = Math.PI / 4;
                rightArm.castShadow = true;
                personGroup.add(rightArm);

                const handGeometry = new THREE.SphereGeometry(armRadius * 1.5, 8, 8);
                const handMaterial = new THREE.MeshStandardMaterial({ color: headColor, roughness: 0.8 });
                const leftHand = new THREE.Mesh(handGeometry, handMaterial);
                leftHand.position.set(
                    leftArm.position.x - Math.sin(Math.PI / 4) * armLength/2,
                    leftArm.position.y - Math.cos(Math.PI / 4) * armLength/2,
                    0
                );
                leftHand.castShadow = true;
                personGroup.add(leftHand);

                const rightHand = new THREE.Mesh(handGeometry, handMaterial);
                rightHand.position.set(
                    rightArm.position.x + Math.sin(Math.PI / 4) * armLength/2,
                    rightArm.position.y - Math.cos(Math.PI / 4) * armLength/2,
                    0
                );
                rightHand.castShadow = true;
                personGroup.add(rightHand);

                const legMaterial = new THREE.MeshStandardMaterial({ color: 0x4B3721 });
                const leftLeg = new THREE.Mesh(new THREE.CylinderGeometry(legRadius, legRadius, legLength, 8), legMaterial);
                leftLeg.position.set(-legXPosition, legLength/2, 0);
                leftLeg.castShadow = true;
                personGroup.add(leftLeg);

                const rightLeg = new THREE.Mesh(new THREE.CylinderGeometry(legRadius, legRadius, legLength, 8), legMaterial);
                rightLeg.position.set(legXPosition, legLength/2, 0);
                rightLeg.castShadow = true;
                personGroup.add(rightLeg);

                const shoeGeometry = new THREE.BoxGeometry(legRadius * 2, 0.2, legRadius * 3);
                const shoeMaterial = new THREE.MeshStandardMaterial({ color: 0x222222 });
                const leftShoe = new THREE.Mesh(shoeGeometry, shoeMaterial);
                leftShoe.position.set(leftLeg.position.x, 0.1, 0);
                leftShoe.castShadow = true;
                personGroup.add(leftShoe);

                const rightShoe = new THREE.Mesh(shoeGeometry, shoeMaterial);
                rightShoe.position.set(rightLeg.position.x, 0.1, 0);
                rightShoe.castShadow = true;
                personGroup.add(rightShoe);

                const hairMaterial = new THREE.MeshStandardMaterial({ color: hairColor, roughness: 0.8 });

                const headGroup = new THREE.Group();
                headGroup.position.y = headYPosition;
                personGroup.add(headGroup);

                const headGeometry = new THREE.SphereGeometry(headSize, 32, 32);
                const head = new THREE.Mesh(headGeometry, neckMaterial);
                headGroup.add(head);

                const eyeMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
                const eyeGeometry = new THREE.SphereGeometry(headSize * 0.1, 16, 16);

                const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
                leftEye.position.set(-headSize * 0.35, headSize * 0.25, headSize * 0.9);
                head.add(leftEye);

                const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
                rightEye.position.set(headSize * 0.35, headSize * 0.25, headSize * 0.9);
                head.add(rightEye);

                const mouthMaterial = new THREE.MeshStandardMaterial({ color: 0xff4d4d });
                const mouthGeometry = new THREE.TorusGeometry(headSize * 0.2, headSize * 0.05, 16, 100, Math.PI);
                const mouth = new THREE.Mesh(mouthGeometry, mouthMaterial);
                mouth.position.set(0, -headSize * 0.2, headSize * 0.9);
                mouth.rotation.x = Math.PI / 2;
                head.add(mouth);

                if (gender === 'female') {
                    function createBraid(segments = 15, segmentHeight = 0.3) {
                        const braidGroup = new THREE.Group();
                        const segmentGeometry = new THREE.CylinderGeometry(0.1, 0.1, segmentHeight * 1.5, 8);

                        for (let i = 0; i < segments; i++) {
                            for (let j = 0; j < 3; j++) {
                                const strand = new THREE.Mesh(segmentGeometry, hairMaterial);
                                strand.position.y = -i * segmentHeight;

                                const angle = (j / 3) * Math.PI * 2;
                                strand.position.x = Math.cos(angle) * 0.1;
                                strand.position.z = Math.sin(angle) * 0.1;

                                strand.rotation.y = (i * Math.PI / 8) + angle;
                                strand.rotation.x = Math.PI / 2;

                                braidGroup.add(strand);
                            }
                        }
                        return braidGroup;
                    }

                    const hairGeometry = new THREE.SphereGeometry(headSize * 1.02, 32, 32, 0, Math.PI * 2, 0, Math.PI / 2);
                    const hair = new THREE.Mesh(hairGeometry, hairMaterial);
                    hair.position.z = -headSize * 0.05;
                    headGroup.add(hair);

                    const leftBraid = createBraid();
                    leftBraid.scale.set(headSize, headSize, headSize);
                    leftBraid.position.set(-headSize * 0.9, 0, 0);
                    leftBraid.rotation.z = Math.PI / 8;
                    leftBraid.rotation.y = -Math.PI / 2;
                    headGroup.add(leftBraid);

                    const rightBraid = createBraid();
                    rightBraid.scale.set(headSize, headSize, headSize);
                    rightBraid.position.set(headSize * 0.9, 0, 0);
                    rightBraid.rotation.z = -Math.PI / 8;
                    rightBraid.rotation.y = Math.PI / 2;
                    headGroup.add(rightBraid);

                } else {
                    const hairGeometry = new THREE.SphereGeometry(headSize * 0.6, 32, 32, 0, Math.PI * 2, 0, Math.PI / 2);
                    const hair = new THREE.Mesh(hairGeometry, hairMaterial);
                    hair.position.y = headSize * 0.6;
                    hair.castShadow = true;
                    headGroup.add(hair);
                }

                personGroup.position.set(x, 0, z);
                personGroup.scale.set(0.7, 0.7, 0.7);
                scene.add(personGroup);
            }

            createSchool(0, -60);

            const clothingColors = [0x4169E1];
            
            const count = 80;

            for (let i = 0; i < count; i++) {
                const treeX = Math.random() * 180 - 90;
                const treeZ = Math.random() * 180 - 90;

                createTree(treeX, treeZ);

                const type = 'child';
                const gender = Math.random() > 0.5 ? 'male' : 'female';
                const bodyType = Math.random() > 0.7 ? 'heavy' : 'normal';
                const randomColor = clothingColors[Math.floor(Math.random() * clothingColors.length)];

                const personX = treeX + 2;
                const personZ = treeZ + 2;

                createPerson(personX, personZ, type, gender, bodyType, randomColor);
                createBucket(personX + 1.5, personZ);
            }

            const moveState = { forward: false, backward: false, left: false, right: false };
            const velocity = new THREE.Vector3();
            const direction = new THREE.Vector3();
            const movementSpeed = 0.2;
            const rotationSpeed = 0.005;

            // تحديث معالجات الأحداث لدعم مفاتيح الأسهم ومفاتيح W, A, S, D
            document.addEventListener('keydown', (e) => {
                switch(e.key.toLowerCase()) {
                    case 'w':
                    case 'arrowup':
                        moveState.forward = true;
                        break;
                    case 's':
                    case 'arrowdown':
                        moveState.backward = true;
                        break;
                    case 'a':
                    case 'arrowleft':
                        moveState.left = true;
                        break;
                    case 'd':
                    case 'arrowright':
                        moveState.right = true;
                        break;
                }
            });

            document.addEventListener('keyup', (e) => {
                switch(e.key.toLowerCase()) {
                    case 'w':
                    case 'arrowup':
                        moveState.forward = false;
                        break;
                    case 's':
                    case 'arrowdown':
                        moveState.backward = false;
                        break;
                    case 'a':
                    case 'arrowleft':
                        moveState.left = false;
                        break;
                    case 'd':
                    case 'arrowright':
                        moveState.right = false;
                        break;
                }
            });

            document.getElementById('forwardBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                moveState.forward = true;
            });
            document.getElementById('forwardBtn').addEventListener('touchend', () => moveState.forward = false);

            document.getElementById('backwardBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                moveState.backward = true;
            });
            document.getElementById('backwardBtn').addEventListener('touchend', () => moveState.backward = false);

            document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                moveState.left = true;
            });
            document.getElementById('leftBtn').addEventListener('touchend', () => moveState.left = false);

            document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                moveState.right = true;
            });
            document.getElementById('rightBtn').addEventListener('touchend', () => moveState.right = false);

            let previousMouseX = 0;
            let previousMouseY = 0;
            let isDragging = false;

            canvas.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMouseX = e.clientX;
                previousMouseY = e.clientY;
                canvas.style.cursor = 'grabbing';
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                canvas.style.cursor = 'grab';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const deltaX = e.clientX - previousMouseX;
                const deltaY = e.clientY - previousMouseY;

                camera.rotation.y -= deltaX * rotationSpeed;
                camera.rotation.x = Math.max(-Math.PI/3, Math.min(Math.PI/3, camera.rotation.x - deltaY * rotationSpeed));

                previousMouseX = e.clientX;
                previousMouseY = e.clientY;
            });

            let previousTouchX = 0;
            let previousTouchY = 0;

            canvas.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    isDragging = true;
                    previousTouchX = e.touches[0].clientX;
                    previousTouchY = e.touches[0].clientY;
                }
            });

            canvas.addEventListener('touchend', () => {
                isDragging = false;
            });

            canvas.addEventListener('touchmove', (e) => {
                if (!isDragging || e.touches.length !== 1) return;

                const deltaX = e.touches[0].clientX - previousTouchX;
                const deltaY = e.touches[0].clientY - previousTouchY;

                camera.rotation.y -= deltaX * rotationSpeed;
                camera.rotation.x = Math.max(-Math.PI/3, Math.min(Math.PI/3, camera.rotation.x - deltaY * rotationSpeed));

                previousTouchX = e.touches[0].clientX;
                previousTouchY = e.touches[0].clientY;
            });

            function animate() {
                requestAnimationFrame(animate);

                velocity.x = 0;
                velocity.z = 0;

                if (moveState.forward) velocity.z -= movementSpeed;
                if (moveState.backward) velocity.z += movementSpeed;
                if (moveState.left) velocity.x -= movementSpeed;
                if (moveState.right) velocity.x += movementSpeed;

                direction.set(velocity.x, 0, velocity.z);
                direction.applyQuaternion(camera.quaternion);
                direction.y = 0;

                camera.position.add(direction);

                camera.position.y = 5;

                camera.position.x = Math.max(-90, Math.min(90, camera.position.x));
                camera.position.z = Math.max(-90, Math.min(90, camera.position.z));

                renderer.render(scene, camera);
            }

            window.addEventListener('resize', () => {
                camera.aspect = canvas.clientWidth / canvas.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            });
            
            const fullscreenBtn = document.getElementById('fullscreenBtn');

            function toggleFullscreen() {
                if (!document.fullscreenElement) {
                    sceneContainer.requestFullscreen().catch(err => {
                        console.error(`Error attempting to enable fullscreen mode: ${err.message}`);
                    });
                } else {
                    document.exitFullscreen();
                }
            }
            
            fullscreenBtn.addEventListener('click', toggleFullscreen);

            document.addEventListener('fullscreenchange', () => {
                setTimeout(() => {
                    const width = document.fullscreenElement ? window.innerWidth : sceneContainer.clientWidth;
                    const height = document.fullscreenElement ? window.innerHeight : sceneContainer.clientHeight;
                    renderer.setSize(width, height);
                    camera.aspect = width / height;
                    camera.updateProjectionMatrix();
                }, 100);
            });

            animate();
        }

        window.addEventListener('load', initScene);
        
        function toggleSolution() {
            const solution = document.getElementById('solution');
            const btn = document.querySelector('.solution-btn');
            
            if (solution.style.display === 'block') {
                solution.style.display = 'none';
                btn.textContent = 'اظهر الحل';
            } else {
                solution.style.display = 'block';
                btn.textContent = 'اخفي الحل';
                if (window.MathJax) {
                    MathJax.typesetPromise([solution]);
                }
            }
        }
    </script>
</body>
</html>



